2025/09/09 15:17:08 Database smartestate already exists
2025/09/09 15:17:08 Database connection established
2025/09/09 15:17:08 Enabling UUID support...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:106
[0m[33m[2.164ms] [34;1m[rows:0][0m CREATE EXTENSION IF NOT EXISTS pgcrypto
2025/09/09 15:17:08 Enabled pgcrypto extension
2025/09/09 15:17:08 Starting migrations...
2025/09/09 15:17:08 Testing with simple model first...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:131
[0m[33m[18.402ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'simple_tests' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:131
[0m[33m[20.349ms] [34;1m[rows:0][0m CREATE TABLE "simple_tests" ("id" bigserial,"name" text,PRIMARY KEY ("id"))

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:137
[0m[33m[15.885ms] [34;1m[rows:0][0m DROP TABLE IF EXISTS simple_tests
2025/09/09 15:17:08 Simple model test passed
2025/09/09 15:17:08 Creating User model structure...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:159
[0m[33m[0.446ms] [34;1m[rows:0][0m 
    CREATE TABLE IF NOT EXISTS users (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        email VARCHAR(255) NOT NULL UNIQUE,
        phone VARCHAR(20),
        password_hash TEXT NOT NULL,
        full_name VARCHAR(255),
        avatar_url VARCHAR(500),
        role VARCHAR(50) DEFAULT 'user',
        subscription_tier VARCHAR(50) DEFAULT 'free',
        created_at TIMESTAMP NOT NULL DEFAULT NOW(),
        updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
        deleted_at TIMESTAMP
    )
2025/09/09 15:17:08 Users table created manually

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:172
[0m[33m[1.228ms] [34;1m[rows:0][0m CREATE INDEX IF NOT EXISTS idx_users_deleted_at ON users(deleted_at)
2025/09/09 15:17:08 Migrating *models.Property...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[1.564ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.638ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[20.517ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'

2025/09/09 15:17:08 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.085ms] [34;1m[rows:-][0m SELECT * FROM "users" LIMIT 1
2025/09/09 15:17:08 Warning: Failed to migrate *models.Property: insufficient arguments (continuing...)
2025/09/09 15:17:08 Migrating *models.PropertyView...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[1.035ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.146ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[9.769ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'

2025/09/09 15:17:08 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.016ms] [34;1m[rows:-][0m SELECT * FROM "users" LIMIT 1
2025/09/09 15:17:08 Warning: Failed to migrate *models.PropertyView: insufficient arguments (continuing...)
2025/09/09 15:17:08 Migrating *models.ChatSession...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.773ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.117ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[6.490ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'

2025/09/09 15:17:08 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.011ms] [34;1m[rows:-][0m SELECT * FROM "users" LIMIT 1
2025/09/09 15:17:08 Warning: Failed to migrate *models.ChatSession: insufficient arguments (continuing...)
2025/09/09 15:17:08 Migrating *models.ChatMessage...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.740ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.128ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[7.462ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'

2025/09/09 15:17:08 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.009ms] [34;1m[rows:-][0m SELECT * FROM "users" LIMIT 1
2025/09/09 15:17:08 Warning: Failed to migrate *models.ChatMessage: insufficient arguments (continuing...)
2025/09/09 15:17:08 Migrating *models.Campaign...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.769ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.121ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[6.878ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'

2025/09/09 15:17:08 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.014ms] [34;1m[rows:-][0m SELECT * FROM "users" LIMIT 1
2025/09/09 15:17:08 Warning: Failed to migrate *models.Campaign: insufficient arguments (continuing...)
2025/09/09 15:17:08 Migrating *models.ParseRequest...

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.210ms] [34;1m[rows:1][0m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'parse_requests' AND table_type = 'BASE TABLE'

2025/09/09 15:17:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[0.113ms] [34;1m[rows:1][0m SELECT CURRENT_DATABASE()

2025/09/09 15:17:09 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189
[0m[33m[6.195ms] [34;1m[rows:-][0m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'smartestate' AND table_schema = CURRENT_SCHEMA() AND table_name = 'parse_requests'

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:189 [35;1minsufficient arguments
[0m[33m[0.013ms] [34;1m[rows:-][0m SELECT * FROM "parse_requests" LIMIT 1
2025/09/09 15:17:09 Warning: Failed to migrate *models.ParseRequest: insufficient arguments (continuing...)
2025/09/09 15:17:09 Adding foreign key constraints...

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_properties_user" for relation "properties" already exists (SQLSTATE 42710)
[0m[33m[1.637ms] [34;1m[rows:0][0m ALTER TABLE properties ADD CONSTRAINT fk_properties_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_properties_user" for relation "properties" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_property_views_property" for relation "property_views" already exists (SQLSTATE 42710)
[0m[33m[0.182ms] [34;1m[rows:0][0m ALTER TABLE property_views ADD CONSTRAINT fk_property_views_property FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_property_views_property" for relation "property_views" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_property_views_user" for relation "property_views" already exists (SQLSTATE 42710)
[0m[33m[0.154ms] [34;1m[rows:0][0m ALTER TABLE property_views ADD CONSTRAINT fk_property_views_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_property_views_user" for relation "property_views" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_chat_sessions_user" for relation "chat_sessions" already exists (SQLSTATE 42710)
[0m[33m[0.216ms] [34;1m[rows:0][0m ALTER TABLE chat_sessions ADD CONSTRAINT fk_chat_sessions_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_chat_sessions_user" for relation "chat_sessions" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_chat_messages_session" for relation "chat_messages" already exists (SQLSTATE 42710)
[0m[33m[0.172ms] [34;1m[rows:0][0m ALTER TABLE chat_messages ADD CONSTRAINT fk_chat_messages_session FOREIGN KEY (session_id) REFERENCES chat_sessions(id) ON DELETE CASCADE
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_chat_messages_session" for relation "chat_messages" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_campaigns_user" for relation "campaigns" already exists (SQLSTATE 42710)
[0m[33m[0.174ms] [34;1m[rows:0][0m ALTER TABLE campaigns ADD CONSTRAINT fk_campaigns_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_campaigns_user" for relation "campaigns" already exists (SQLSTATE 42710)

2025/09/09 15:17:09 [31;1m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/database/db.go:209 [35;1mERROR: constraint "fk_parse_requests_user" for relation "parse_requests" already exists (SQLSTATE 42710)
[0m[33m[0.166ms] [34;1m[rows:0][0m ALTER TABLE parse_requests ADD CONSTRAINT fk_parse_requests_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
2025/09/09 15:17:09 Note: Could not add constraint (may already exist): ERROR: constraint "fk_parse_requests_user" for relation "parse_requests" already exists (SQLSTATE 42710)
2025/09/09 15:17:09 All migrations completed
2025/09/09 15:17:09 Database initialized successfully
2025/09/09 15:17:09 Warning: Could not connect to Redis: dial tcp [::1]:6379: connect: connection refused
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /swagger/*any             --> github.com/swaggo/gin-swagger.CustomWrapHandler.func1 (4 handlers)
[GIN-debug] GET    /api/health               --> smartestate/internal/api/handlers.Health (4 handlers)
[GIN-debug] POST   /api/auth/register        --> smartestate/internal/api/handlers.(*AuthHandler).Register-fm (4 handlers)
[GIN-debug] POST   /api/auth/login           --> smartestate/internal/api/handlers.(*AuthHandler).Login-fm (4 handlers)
[GIN-debug] POST   /api/auth/refresh         --> smartestate/internal/api/handlers.(*AuthHandler).RefreshToken-fm (4 handlers)
[GIN-debug] POST   /api/auth/logout          --> smartestate/internal/api/handlers.(*AuthHandler).Logout-fm (5 handlers)
[GIN-debug] GET    /api/auth/profile         --> smartestate/internal/api/handlers.(*AuthHandler).GetProfile-fm (5 handlers)
[GIN-debug] GET    /api/properties           --> smartestate/internal/api/handlers.(*PropertyHandler).List-fm (4 handlers)
[GIN-debug] GET    /api/properties/:id       --> smartestate/internal/api/handlers.(*PropertyHandler).Get-fm (4 handlers)
[GIN-debug] GET    /api/properties/search    --> smartestate/internal/api/handlers.(*PropertyHandler).Search-fm (4 handlers)
[GIN-debug] GET    /api/properties/recommendations --> smartestate/internal/api/handlers.(*PropertyHandler).GetRecommendations-fm (5 handlers)
[GIN-debug] POST   /api/properties           --> smartestate/internal/api/handlers.(*PropertyHandler).Create-fm (5 handlers)
[GIN-debug] PUT    /api/properties/:id       --> smartestate/internal/api/handlers.(*PropertyHandler).Update-fm (5 handlers)
[GIN-debug] DELETE /api/properties/:id       --> smartestate/internal/api/handlers.(*PropertyHandler).Delete-fm (5 handlers)
[GIN-debug] POST   /api/properties/:id/images --> smartestate/internal/api/handlers.(*PropertyHandler).UploadImages-fm (5 handlers)
[GIN-debug] POST   /api/properties/:id/view  --> smartestate/internal/api/handlers.(*PropertyHandler).RecordView-fm (5 handlers)
[GIN-debug] POST   /api/chat/sessions        --> smartestate/internal/api/handlers.(*ChatHandler).CreateSession-fm (5 handlers)
[GIN-debug] GET    /api/chat/sessions/:id    --> smartestate/internal/api/handlers.(*ChatHandler).GetSession-fm (5 handlers)
[GIN-debug] POST   /api/chat/messages        --> smartestate/internal/api/handlers.(*ChatHandler).SendMessage-fm (5 handlers)
[GIN-debug] GET    /api/chat/sessions/:id/messages --> smartestate/internal/api/handlers.(*ChatHandler).GetMessages-fm (5 handlers)
[GIN-debug] POST   /api/targeting/campaigns  --> smartestate/internal/api/handlers.(*TargetingHandler).CreateCampaign-fm (5 handlers)
[GIN-debug] GET    /api/targeting/campaigns  --> smartestate/internal/api/handlers.(*TargetingHandler).ListCampaigns-fm (5 handlers)
[GIN-debug] GET    /api/targeting/campaigns/:id --> smartestate/internal/api/handlers.(*TargetingHandler).GetCampaign-fm (5 handlers)
[GIN-debug] POST   /api/targeting/campaigns/:id/launch --> smartestate/internal/api/handlers.(*TargetingHandler).LaunchCampaign-fm (5 handlers)
[GIN-debug] GET    /api/targeting/campaigns/:id/metrics --> smartestate/internal/api/handlers.(*TargetingHandler).GetMetrics-fm (5 handlers)
[GIN-debug] POST   /api/targeting/generate-creatives --> smartestate/internal/api/handlers.(*TargetingHandler).GenerateCreatives-fm (5 handlers)
[GIN-debug] GET    /api/analytics/properties/:id --> smartestate/internal/api/handlers.(*AnalyticsHandler).PropertyAnalytics-fm (5 handlers)
[GIN-debug] GET    /api/analytics/campaigns/:id --> smartestate/internal/api/handlers.(*AnalyticsHandler).CampaignAnalytics-fm (5 handlers)
[GIN-debug] GET    /api/analytics/market-trends --> smartestate/internal/api/handlers.(*AnalyticsHandler).MarketTrends-fm (5 handlers)
[GIN-debug] POST   /api/parser/properties    --> smartestate/internal/api/handlers.(*ParserHandler).ParseProperties-fm (4 handlers)
[GIN-debug] GET    /api/parser/requests/:id  --> smartestate/internal/api/handlers.(*ParserHandler).GetParseRequest-fm (4 handlers)
[GIN-debug] GET    /api/parser/test          --> smartestate/internal/api/handlers.(*ParserHandler).TestParse-fm (4 handlers)
[GIN-debug] GET    /api/ws/chat              --> smartestate/internal/api/handlers.(*ChatHandler).HandleWebSocket-fm (5 handlers)
[GIN-debug] GET    /uploads/*filepath        --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (4 handlers)
[GIN-debug] HEAD   /uploads/*filepath        --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (4 handlers)
2025/09/09 15:17:09 🚀 Server started on port 8080
2025/09/09 15:17:09 📚 Swagger docs: http://localhost:8080/swagger/index.html
2025/09/09 15:17:09 💡 API Health: http://localhost:8080/api/health

2025/09/09 15:17:37 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:20
[0m[33m[14.312ms] [34;1m[rows:1][0m INSERT INTO "chat_sessions" ("id","user_id","context","created_at","updated_at") VALUES ('80edc322-1504-456c-8ff8-b550a98e8015','16a4c900-a736-4ab9-9766-518da0644a49','{"property_preferences":{},"search_history":[],"last_intent":""}','2025-09-09 15:17:36.989','2025-09-09 15:17:36.989')
[GIN] 2025/09/09 - 15:17:37 | 201 |   15.743583ms |             ::1 | POST     "/api/chat/sessions"

2025/09/09 15:17:37 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/user_service.go:24
[0m[33m[16.115ms] [34;1m[rows:1][0m SELECT * FROM "users" WHERE id = '16a4c900-a736-4ab9-9766-518da0644a49' ORDER BY "users"."id" LIMIT 1
[GIN] 2025/09/09 - 15:17:37 | 200 |   16.575583ms |             ::1 | GET      "/api/auth/profile"

2025/09/09 15:17:37 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/user_service.go:24
[0m[33m[0.275ms] [34;1m[rows:1][0m SELECT * FROM "users" WHERE id = '16a4c900-a736-4ab9-9766-518da0644a49' ORDER BY "users"."id" LIMIT 1
[GIN] 2025/09/09 - 15:17:37 | 200 |     414.834µs |             ::1 | GET      "/api/auth/profile"

2025/09/09 15:17:37 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:20
[0m[33m[12.919ms] [34;1m[rows:1][0m INSERT INTO "chat_sessions" ("id","user_id","context","created_at","updated_at") VALUES ('586235ce-4f09-429a-8cf8-bdc1a607f4f6','16a4c900-a736-4ab9-9766-518da0644a49','{"property_preferences":{},"search_history":[],"last_intent":""}','2025-09-09 15:17:37.002','2025-09-09 15:17:37.002')
[GIN] 2025/09/09 - 15:17:37 | 201 |   13.038375ms |             ::1 | POST     "/api/chat/sessions"

2025/09/09 15:17:40 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[1.851ms] [34;1m[rows:0][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '586235ce-4f09-429a-8cf8-bdc1a607f4f6'

2025/09/09 15:17:40 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[5.360ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '586235ce-4f09-429a-8cf8-bdc1a607f4f6' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:17:40 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[2.380ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('0402b4ab-8154-4c26-8f13-106835415ecb','586235ce-4f09-429a-8cf8-bdc1a607f4f6','user','Найди 2-комн в Алматы до 40 млн','{}','2025-09-09 15:17:40.109')

2025/09/09 15:17:40 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.249ms] [34;1m[rows:1][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '586235ce-4f09-429a-8cf8-bdc1a607f4f6'

2025/09/09 15:17:40 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.550ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '586235ce-4f09-429a-8cf8-bdc1a607f4f6' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:17:43 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[3.479ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('8b368b53-5cf7-4d00-935b-368fc0210907','586235ce-4f09-429a-8cf8-bdc1a607f4f6','assistant','Понял ваши требования:
✅ 2-комнатная квартира
✅ Город: Алматы  
✅ Бюджет: до 40 млн тенге

Подтверждаете поиск? Напишите ''Да'' и я начну парсинг.','{"confidence":0.85}','2025-09-09 15:17:43.098')
[GIN] 2025/09/09 - 15:17:43 | 200 |     2.998908s |             ::1 | POST     "/api/chat/messages"

2025/09/09 15:17:52 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.560ms] [34;1m[rows:2][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '586235ce-4f09-429a-8cf8-bdc1a607f4f6'

2025/09/09 15:17:52 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[2.267ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '586235ce-4f09-429a-8cf8-bdc1a607f4f6' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:17:52 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[0.834ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('0468eedc-808c-4e02-a320-41125d683ccd','586235ce-4f09-429a-8cf8-bdc1a607f4f6','user','да','{}','2025-09-09 15:17:52.089')

2025/09/09 15:17:52 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.160ms] [34;1m[rows:3][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '586235ce-4f09-429a-8cf8-bdc1a607f4f6'

2025/09/09 15:17:52 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.370ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '586235ce-4f09-429a-8cf8-bdc1a607f4f6' ORDER BY "chat_sessions"."id" LIMIT 1
[AI SERVICE] Проверка подтверждения для текста: 'да'
[AI SERVICE] Найдено слово подтверждения: 'да', hasConfirmation: true

2025/09/09 15:17:53 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/parser_service.go:41
[0m[33m[4.765ms] [34;1m[rows:1][0m INSERT INTO "parse_requests" ("id","user_id","filters","max_pages","status","results","count","error","created_at","updated_at") VALUES ('9c52cf0a-ae24-467f-867d-74cd12a7b1a1',NULL,'{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""}',3,'processing','null',0,'','2025-09-09 15:17:53.721','2025-09-09 15:17:53.721')
2025/09/09 15:17:53 Trying to create firefox WebDriver session...
2025/09/09 15:18:01 firefox WebDriver session created successfully
2025/09/09 15:18:01 Parsing page 1: https://krisha.kz/prodazha/kvartiry/almaty?das%5Blive.rooms%5D%5B%5D=2&das%5Bprice%5D%5Bto%5D=40000000
2025/09/09 15:18:11 Found 23 property cards on page 1
2025/09/09 15:18:11 Parsing property card 1/3
2025/09/09 15:18:11 Searching for price in property: 2-комнатная квартира · 55 м² · 9/12 этаж
2025/09/09 15:18:11 Price selector 1 (.a-card__price): found text='26 000 000 〒'
2025/09/09 15:18:11 Parsing price text: '26 000 000 〒'
2025/09/09 15:18:11 Parsed price: 26 000 000 〒 -> 26000000 ₸
2025/09/09 15:18:14 Found image: https://krisha-photos.kcdn.online/webp/21/21f15ad3-01e9-471e-9677-c416b001d9c2/10-400x300.jpg
2025/09/09 15:18:14 Parsing property card 2/3
2025/09/09 15:18:14 Searching for price in property: 2-комнатная квартира · 56.18 м² · 4/10 этаж
2025/09/09 15:18:14 Price selector 1 (.a-card__price): found text='27 000 000 〒'
2025/09/09 15:18:14 Parsing price text: '27 000 000 〒'
2025/09/09 15:18:14 Parsed price: 27 000 000 〒 -> 27000000 ₸
2025/09/09 15:18:16 Found image: https://krisha-photos.kcdn.online/webp/4f/4f70129a-abfd-4fb7-93cf-f1a6337ff3a6/3-400x300.jpg
2025/09/09 15:18:16 Parsing property card 3/3
2025/09/09 15:18:16 Searching for price in property: 2-комнатная квартира · 44 м² · 13/14 этаж
2025/09/09 15:18:16 Price selector 1 (.a-card__price): found text='27 000 000 〒'
2025/09/09 15:18:16 Parsing price text: '27 000 000 〒'
2025/09/09 15:18:16 Parsed price: 27 000 000 〒 -> 27000000 ₸
2025/09/09 15:18:19 Found image: https://krisha-photos.kcdn.online/webp/53/53f3a8c5-7822-4cb7-af99-2ab137f3ea06/5-400x300.jpg
2025/09/09 15:18:21 Closing WebDriver session...

2025/09/09 15:18:22 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/parser_service.go:70
[0m[33m[33.909ms] [34;1m[rows:1][0m UPDATE "parse_requests" SET "user_id"=NULL,"filters"='{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""}',"max_pages"=3,"status"='completed',"results"='[{"id":"1004467960","title":"2-комнатная квартира · 55 м² · 9/12 этаж","price":26000000,"currency":"₸","address":"Алатауский р-н, мкр Алгабас, Омарова 5","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/21/21f15ad3-01e9-471e-9677-c416b001d9c2/10-750x470.webp"],"description":"2-комнатная квартира · 55 м² · 9/12 этаж","url":"/a/show/1004467960?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=1","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1002799856","title":"2-комнатная квартира · 56.18 м² · 4/10 этаж","price":27000000,"currency":"₸","address":"Наурызбайский р-н, Алтын Орда 7/1а — Напротив Алтын Орда","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/4f/4f70129a-abfd-4fb7-93cf-f1a6337ff3a6/3-750x470.webp"],"description":"2-комнатная квартира · 56.18 м² · 4/10 этаж","url":"/a/show/1002799856?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=2","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1002444910","title":"2-комнатная квартира · 44 м² · 13/14 этаж","price":27000000,"currency":"₸","address":"Алмалинский р-н, Муратбаева 14 — Макатаева муратбаева","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/53/53f3a8c5-7822-4cb7-af99-2ab137f3ea06/5-750x470.webp"],"description":"2-комнатная квартира · 44 м² · 13/14 этаж","url":"/a/show/1002444910?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=3","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""}]',"count"=3,"error"='',"created_at"='2025-09-09 15:17:53.721',"updated_at"='2025-09-09 15:18:22.349' WHERE "id" = '9c52cf0a-ae24-467f-867d-74cd12a7b1a1'

2025/09/09 15:18:22 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[8.067ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('6e226186-f229-4882-b5ee-edc2ecc5c62e','586235ce-4f09-429a-8cf8-bdc1a607f4f6','assistant','🏠 Найдено 3 объектов недвижимости в городе Алматы, 2-комнатные:

🏢 **2-комнатная квартира · 55 м² · 9/12 этаж**
💰 Цена: 26.0 млн тенге
📍 Адрес: Алатауский р-н, мкр Алгабас, Омарова 5
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/21/21f15ad3-01e9-471e-9677-c416b001d9c2/10-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/1004467960?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a&srchtype=hot_block_filter&srchpos=1)

---

🏢 **2-комнатная квартира · 56.18 м² · 4/10 этаж**
💰 Цена: 27.0 млн тенге
📍 Адрес: Наурызбайский р-н, Алтын Орда 7/1а — Напротив Алтын Орда
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/4f/4f70129a-abfd-4fb7-93cf-f1a6337ff3a6/3-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/1002799856?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a&srchtype=hot_block_filter&srchpos=2)

---

🏢 **2-комнатная квартира · 44 м² · 13/14 этаж**
💰 Цена: 27.0 млн тенге
📍 Адрес: Алмалинский р-н, Муратбаева 14 — Макатаева муратбаева
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/53/53f3a8c5-7822-4cb7-af99-2ab137f3ea06/5-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/1002444910?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a&srchtype=hot_block_filter&srchpos=3)

---

Хотите уточнить поиск или получить больше информации о каком-то объекте?','{"property_ids":["1004467960","1002799856","1002444910"],"actions":["search_completed","properties_found"],"confidence":0.95,"extra":{"filters_used":{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""},"parse_request_id":"9c52cf0a-ae24-467f-867d-74cd12a7b1a1","properties":[{"id":"1004467960","title":"2-комнатная квартира · 55 м² · 9/12 этаж","price":26000000,"currency":"₸","address":"Алатауский р-н, мкр Алгабас, Омарова 5","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/21/21f15ad3-01e9-471e-9677-c416b001d9c2/10-750x470.webp"],"description":"2-комнатная квартира · 55 м² · 9/12 этаж","url":"/a/show/1004467960?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=1","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1002799856","title":"2-комнатная квартира · 56.18 м² · 4/10 этаж","price":27000000,"currency":"₸","address":"Наурызбайский р-н, Алтын Орда 7/1а — Напротив Алтын Орда","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/4f/4f70129a-abfd-4fb7-93cf-f1a6337ff3a6/3-750x470.webp"],"description":"2-комнатная квартира · 56.18 м² · 4/10 этаж","url":"/a/show/1002799856?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=2","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1002444910","title":"2-комнатная квартира · 44 м² · 13/14 этаж","price":27000000,"currency":"₸","address":"Алмалинский р-н, Муратбаева 14 — Макатаева муратбаева","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/53/53f3a8c5-7822-4cb7-af99-2ab137f3ea06/5-750x470.webp"],"description":"2-комнатная квартира · 44 м² · 13/14 этаж","url":"/a/show/1002444910?srchid=01992dfb-8c27-7557-9a17-6cdc9b9a5a6a\u0026srchtype=hot_block_filter\u0026srchpos=3","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""}],"total_found":3}}','2025-09-09 15:18:22.383')
[GIN] 2025/09/09 - 15:18:22 | 200 | 30.304794875s |             ::1 | POST     "/api/chat/messages"

2025/09/09 15:21:01 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:20
[0m[33m[111.941ms] [34;1m[rows:1][0m INSERT INTO "chat_sessions" ("id","user_id","context","created_at","updated_at") VALUES ('0d702a1a-1934-4398-a151-7fc3346f3fa5','16a4c900-a736-4ab9-9766-518da0644a49','{"property_preferences":{},"search_history":[],"last_intent":""}','2025-09-09 15:21:01.411','2025-09-09 15:21:01.411')
[GIN] 2025/09/09 - 15:21:01 | 201 |  148.521417ms |             ::1 | POST     "/api/chat/sessions"

2025/09/09 15:21:01 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:20
[0m[33m[130.271ms] [34;1m[rows:1][0m INSERT INTO "chat_sessions" ("id","user_id","context","created_at","updated_at") VALUES ('1306b135-52a7-4b50-9a7d-63ca8b54847a','16a4c900-a736-4ab9-9766-518da0644a49','{"property_preferences":{},"search_history":[],"last_intent":""}','2025-09-09 15:21:01.463','2025-09-09 15:21:01.463')
[GIN] 2025/09/09 - 15:21:01 | 201 |  158.039167ms |             ::1 | POST     "/api/chat/sessions"

2025/09/09 15:21:01 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/user_service.go:24
[0m[33m[129.468ms] [34;1m[rows:1][0m SELECT * FROM "users" WHERE id = '16a4c900-a736-4ab9-9766-518da0644a49' ORDER BY "users"."id" LIMIT 1
[GIN] 2025/09/09 - 15:21:01 | 200 |  160.846291ms |             ::1 | GET      "/api/auth/profile"

2025/09/09 15:21:01 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/user_service.go:24
[0m[33m[0.268ms] [34;1m[rows:1][0m SELECT * FROM "users" WHERE id = '16a4c900-a736-4ab9-9766-518da0644a49' ORDER BY "users"."id" LIMIT 1
[GIN] 2025/09/09 - 15:21:01 | 200 |     837.417µs |             ::1 | GET      "/api/auth/profile"

2025/09/09 15:21:03 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[1.817ms] [34;1m[rows:0][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '1306b135-52a7-4b50-9a7d-63ca8b54847a'

2025/09/09 15:21:03 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[6.246ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '1306b135-52a7-4b50-9a7d-63ca8b54847a' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:21:03 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[2.119ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('97f4e8f5-b968-4c0b-a0a3-f375a2b657e9','1306b135-52a7-4b50-9a7d-63ca8b54847a','user','Найди 2-комн в Алматы до 40 млн','{}','2025-09-09 15:21:03.961')

2025/09/09 15:21:03 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.239ms] [34;1m[rows:1][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '1306b135-52a7-4b50-9a7d-63ca8b54847a'

2025/09/09 15:21:03 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[2.206ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '1306b135-52a7-4b50-9a7d-63ca8b54847a' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:21:08 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[2.595ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('be3ed514-a3e6-4214-a6bb-aa23bb13588b','1306b135-52a7-4b50-9a7d-63ca8b54847a','assistant','Понял ваши требования:
✅ 2-комнатная квартира
✅ Город: Алматы  
✅ Бюджет: до 40 млн тенге

Подтверждаете поиск? Напишите ''Да'' и я начну парсинг.','{"confidence":0.85}','2025-09-09 15:21:08.615')
[GIN] 2025/09/09 - 15:21:08 | 200 |  4.664155584s |             ::1 | POST     "/api/chat/messages"

2025/09/09 15:21:27 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.786ms] [34;1m[rows:2][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '1306b135-52a7-4b50-9a7d-63ca8b54847a'

2025/09/09 15:21:27 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[3.717ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '1306b135-52a7-4b50-9a7d-63ca8b54847a' ORDER BY "chat_sessions"."id" LIMIT 1

2025/09/09 15:21:27 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[1.974ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('195701e4-92b3-4f11-91b8-681ce7f6aa1b','1306b135-52a7-4b50-9a7d-63ca8b54847a','user','да','{}','2025-09-09 15:21:27.085')

2025/09/09 15:21:27 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.424ms] [34;1m[rows:3][0m SELECT * FROM "chat_messages" WHERE "chat_messages"."session_id" = '1306b135-52a7-4b50-9a7d-63ca8b54847a'

2025/09/09 15:21:27 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:25
[0m[33m[0.915ms] [34;1m[rows:1][0m SELECT * FROM "chat_sessions" WHERE id = '1306b135-52a7-4b50-9a7d-63ca8b54847a' ORDER BY "chat_sessions"."id" LIMIT 1
[AI SERVICE] Проверка подтверждения для текста: 'да'
[AI SERVICE] Найдено слово подтверждения: 'да', hasConfirmation: true

2025/09/09 15:21:28 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/parser_service.go:41
[0m[33m[4.900ms] [34;1m[rows:1][0m INSERT INTO "parse_requests" ("id","user_id","filters","max_pages","status","results","count","error","created_at","updated_at") VALUES ('0a5741a8-c8e4-464c-aaef-320d28906246',NULL,'{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""}',3,'processing','null',0,'','2025-09-09 15:21:28.891','2025-09-09 15:21:28.891')
2025/09/09 15:21:28 Trying to create firefox WebDriver session...
2025/09/09 15:21:33 firefox WebDriver session created successfully
2025/09/09 15:21:33 Parsing page 1: https://krisha.kz/prodazha/kvartiry/almaty?das%5Blive.rooms%5D%5B%5D=2&das%5Bprice%5D%5Bto%5D=40000000
2025/09/09 15:21:42 Found 23 property cards on page 1
2025/09/09 15:21:42 Parsing property card 1/3
2025/09/09 15:21:43 Searching for price in property: 2-комнатная квартира · 47 м² · 2/4 этаж
2025/09/09 15:21:43 Price selector 1 (.a-card__price): found text='35 000 000 〒'
2025/09/09 15:21:43 Parsing price text: '35 000 000 〒'
2025/09/09 15:21:43 Parsed price: 35 000 000 〒 -> 35000000 ₸
2025/09/09 15:21:45 Found image: https://krisha-photos.kcdn.online/webp/85/857d9c14-c852-443c-9857-18d1adf9948f/19-400x300.jpg
2025/09/09 15:21:45 Parsing property card 2/3
2025/09/09 15:21:45 Searching for price in property: 2-комнатная квартира · 45 м² · 4/4 этаж
2025/09/09 15:21:45 Price selector 1 (.a-card__price): found text='26 700 000 〒'
2025/09/09 15:21:45 Parsing price text: '26 700 000 〒'
2025/09/09 15:21:45 Parsed price: 26 700 000 〒 -> 26700000 ₸
2025/09/09 15:21:48 Found image: https://krisha-photos.kcdn.online/webp/4f/4f9041ae-f7cf-4313-b75c-df6848cff367/1-400x300.jpg
2025/09/09 15:21:48 Parsing property card 3/3
2025/09/09 15:21:48 Searching for price in property: 2-комнатная квартира · 51 м² · 2/10 этаж
2025/09/09 15:21:48 Price selector 1 (.a-card__price): found text='34 500 000 〒'
2025/09/09 15:21:48 Parsing price text: '34 500 000 〒'
2025/09/09 15:21:48 Parsed price: 34 500 000 〒 -> 34500000 ₸
2025/09/09 15:21:50 Found image: https://krisha-photos.kcdn.online/webp/13/13b13c59-e862-49d8-a65b-197ead522058/45-400x300.jpg
2025/09/09 15:21:52 Closing WebDriver session...

2025/09/09 15:21:53 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/parser_service.go:70
[0m[33m[50.961ms] [34;1m[rows:1][0m UPDATE "parse_requests" SET "user_id"=NULL,"filters"='{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""}',"max_pages"=3,"status"='completed',"results"='[{"id":"1000297189","title":"2-комнатная квартира · 47 м² · 2/4 этаж","price":35000000,"currency":"₸","address":"Алмалинский р-н, Ауэзова 64/2","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/85/857d9c14-c852-443c-9857-18d1adf9948f/19-750x470.webp"],"description":"2-комнатная квартира · 47 м² · 2/4 этаж","url":"/a/show/1000297189?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=1","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1003433154","title":"2-комнатная квартира · 45 м² · 4/4 этаж","price":26700000,"currency":"₸","address":"Ауэзовский р-н, мкр №1 49 — Алтынсарина","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/4f/4f9041ae-f7cf-4313-b75c-df6848cff367/1-750x470.webp"],"description":"2-комнатная квартира · 45 м² · 4/4 этаж","url":"/a/show/1003433154?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=2","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"693821416","title":"2-комнатная квартира · 51 м² · 2/10 этаж","price":34500000,"currency":"₸","address":"Турксибский р-н, Сейфуллина 51 — 1-Алматы ЖД Вокзал","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/13/13b13c59-e862-49d8-a65b-197ead522058/45-750x470.webp"],"description":"2-комнатная квартира · 51 м² · 2/10 этаж","url":"/a/show/693821416?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=3","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""}]',"count"=3,"error"='',"created_at"='2025-09-09 15:21:28.891',"updated_at"='2025-09-09 15:21:53.683' WHERE "id" = '0a5741a8-c8e4-464c-aaef-320d28906246'

2025/09/09 15:21:53 [32m/Users/syrymumbetov/Desktop/Projects/ai-rieltor/smartestate-backend/internal/services/chat_service.go:30
[0m[33m[3.190ms] [34;1m[rows:1][0m INSERT INTO "chat_messages" ("id","session_id","role","content","metadata","created_at") VALUES ('c8706e57-1677-465a-b7a5-9921d81d6cb5','1306b135-52a7-4b50-9a7d-63ca8b54847a','assistant','🏠 Найдено 3 объектов недвижимости в городе Алматы, 2-комнатные:

🏢 **2-комнатная квартира · 47 м² · 2/4 этаж**
💰 Цена: 35.0 млн тенге
📍 Адрес: Алмалинский р-н, Ауэзова 64/2
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/85/857d9c14-c852-443c-9857-18d1adf9948f/19-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/1000297189?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af&srchtype=hot_block_filter&srchpos=1)

---

🏢 **2-комнатная квартира · 45 м² · 4/4 этаж**
💰 Цена: 26.7 млн тенге
📍 Адрес: Ауэзовский р-н, мкр №1 49 — Алтынсарина
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/4f/4f9041ae-f7cf-4313-b75c-df6848cff367/1-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/1003433154?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af&srchtype=hot_block_filter&srchpos=2)

---

🏢 **2-комнатная квартира · 51 м² · 2/10 этаж**
💰 Цена: 34.5 млн тенге
📍 Адрес: Турксибский р-н, Сейфуллина 51 — 1-Алматы ЖД Вокзал
📸 Фото:
![Фото 1](https://krisha-photos.kcdn.online/webp/13/13b13c59-e862-49d8-a65b-197ead522058/45-750x470.webp)
🔗 [Подробнее](https://krisha.kz/a/show/693821416?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af&srchtype=hot_block_filter&srchpos=3)

---

Хотите уточнить поиск или получить больше информации о каком-то объекте?','{"property_ids":["1000297189","1003433154","693821416"],"actions":["search_completed","properties_found"],"confidence":0.95,"extra":{"filters_used":{"property_type":"","city":"Алматы","rooms":2,"price_min":null,"price_max":40000000,"total_area_from":null,"total_area_to":null,"floor_from":null,"floor_to":null,"total_floors_from":null,"total_floors_to":null,"build_year_from":null,"build_year_to":null,"has_photos":false,"is_new_building":false,"seller_type":"","not_first_floor":false,"not_last_floor":false,"residential_complex":""},"parse_request_id":"0a5741a8-c8e4-464c-aaef-320d28906246","properties":[{"id":"1000297189","title":"2-комнатная квартира · 47 м² · 2/4 этаж","price":35000000,"currency":"₸","address":"Алмалинский р-н, Ауэзова 64/2","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/85/857d9c14-c852-443c-9857-18d1adf9948f/19-750x470.webp"],"description":"2-комнатная квартира · 47 м² · 2/4 этаж","url":"/a/show/1000297189?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=1","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"1003433154","title":"2-комнатная квартира · 45 м² · 4/4 этаж","price":26700000,"currency":"₸","address":"Ауэзовский р-н, мкр №1 49 — Алтынсарина","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/4f/4f9041ae-f7cf-4313-b75c-df6848cff367/1-750x470.webp"],"description":"2-комнатная квартира · 45 м² · 4/4 этаж","url":"/a/show/1003433154?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=2","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""},{"id":"693821416","title":"2-комнатная квартира · 51 м² · 2/10 этаж","price":34500000,"currency":"₸","address":"Турксибский р-н, Сейфуллина 51 — 1-Алматы ЖД Вокзал","rooms":null,"area":null,"floor":null,"total_floors":null,"build_year":null,"images":["https://krisha-photos.kcdn.online/webp/13/13b13c59-e862-49d8-a65b-197ead522058/45-750x470.webp"],"description":"2-комнатная квартира · 51 м² · 2/10 этаж","url":"/a/show/693821416?srchid=01992dfe-c5f6-7f78-8e7a-bded853980af\u0026srchtype=hot_block_filter\u0026srchpos=3","phone":"","is_new_building":false,"building_type":"","seller_type":"","kitchen_area":null,"residential_complex":""}],"total_found":3}}','2025-09-09 15:21:53.702')
[GIN] 2025/09/09 - 15:21:53 | 200 | 26.624705209s |             ::1 | POST     "/api/chat/messages"
